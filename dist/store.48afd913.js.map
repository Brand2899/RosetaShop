{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,SCAAC,EAAAD,EAAA,SCAAC,EAAAD,EAAA,0BFKA,MAAME,EAAaC,SAASC,eAAe,cACrCC,EAAWF,SAASC,eAAe,kBAEzC,IAAIE,EACAC,EAAoB,GACpBC,EAAO,GAGXC,eAAeC,IACX,IACI,MAAMC,QCbdF,eAA2BG,GACvB,IACI,MAAMC,EAAgBZ,EAAAa,WAAWF,EAAI,aAJ7CG,KAKgBA,SAAed,EAAAe,QAAQH,GAS/B,OAPiBE,EAAKE,KAAKC,IACjB,IACCA,EAAIC,OACPC,GAAIF,EAAIE,OAKlB,MAAMC,GACJC,QAAQC,IAAIF,IDDgBG,CAAYzB,EAAAa,IACxCV,EAAWuB,UAAY,GAEvBd,EAAce,SAASC,IACnBC,EAAcD,MAGlBpB,EAAoBI,EACtB,MAAMU,GACJC,QAAQC,IAAIF,IAIpB,SAASO,EAAeC,GACpB,MAAMC,EAAoB3B,SAAS4B,cAAc,KAEjDD,EAAkBE,UAAY,WAC9BF,EAAkBG,aAAa,OAAQ,qBAAqBJ,EAAST,MAErE,MAAMc,EAASL,EAASM,YAAcN,EAASM,YAAY,GAAK,mLAExDC,aAAcC,EAAMC,cAAeC,EAAOC,kBAAmBC,EAAWC,cAAeC,EAAOC,kBAAmBC,EAAWC,iBAAkBC,GAAalB,EAI7JmB,EAFsBxC,EAAKyC,MAAMC,GAAgBA,EAAY9B,KAAOS,EAAST,KAEtC,wEAAuE,+DAElHU,EAAgBL,UAAY,yCAUnBS,sDAIXG,wBACME,uDAGaI,2BAIfQ,YAAmBrB,SAEnBsB,EAAGtB,EAAUuB,cACH,uBAGVC,iBAA2B,SAAA7C,MAAgBY,IAC3CA,EAAAkC,iBACD/C,EAAAgD,KAAA,IACN3B,EAED4B,MAhEY,qBA4ERC,aAAMC,QAAA,OAAmBC,KAAAC,UAAArD,IAV5BsD,GAEQxD,SE7ETG,eAAkCG,EAAImD,EAAQC,GAC1C,UACU/D,EAAAgE,OAAOhE,EAAAiB,IAAIN,EAAI,OAAQmD,GAAS,MAACC,IACzC,MAAM3C,GACJC,QAAQC,IAAIF,IFyEA6C,CAAAnE,EAAAa,GAAAN,EAAA6D,IAAA3D,GAChB4C,EAAenB,aAAa,YAAgB,GAC5CmB,EAAgBgB,UAAW,mEAiB9B,MAAAC,EAAAhE,EAAAiE,MAEDC,EAAAhE,EAAyCiE,QAAA7C,GAAAA,EAAAmB,mBAAAuB,IAEtC,IAAAE,EAAAE,QAAA/D,IAEHR,EAAeuB,UAAA,GAEf8C,EAAA7C,SAAAC,IAOIC,EAAeD","sources":["js/store.js","js/scripts/storeScript.js","js/cart.js"],"sourcesContent":["import { auth, db } from \"./app\";\r\nimport { getProducts } from \"./scripts/storeScript\";\r\nimport { createFirebaseCart, getFirebaseCart } from \"./cart\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\n\r\nconst stockPrint = document.getElementById(\"stockPrint\");\r\nconst ctFilter = document.getElementById(\"categoryFilter\");\r\n\r\nlet userLogged = undefined;\r\nlet displayedProducts = [];\r\nlet cart = [];\r\nlet count = 1;\r\n\r\nasync function loadProducts(){\r\n    try{\r\n        const stockProducts = await getProducts(db);\r\n        stockPrint.innerHTML = \"\";\r\n        \r\n        stockProducts.forEach( product => {\r\n            renderProduct(product);\r\n        });\r\n\r\n        displayedProducts = stockProducts;\r\n    } catch(e){\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nfunction renderProduct( iproduct ){\r\n    const individualProduct = document.createElement(\"a\");\r\n\r\n    individualProduct.className = \"iproduct\";\r\n    individualProduct.setAttribute(\"href\", `./product.html?id=${iproduct.id}`);\r\n\r\n    const images = iproduct.product_img ? iproduct.product_img[0] : \"https://firebasestorage.googleapis.com/v0/b/rosetashop-157e2.appspot.com/o/products%2Fimages%2Fimg_general_placeholder.jpg?alt=media&token=f88f5f6f-7729-4680-94be-2d9b49f82bd4\";\r\n\r\n    const { product_name: name, product_price: price, product_reference: reference, product_color: color, product_colection: colection, product_category: category } = iproduct;\r\n\r\n   const isProductAddedToCart = cart.some((productCart) => productCart.id === iproduct.id);\r\n\r\n    const buttonAddCart = isProductAddedToCart ? '<button class=\"iproduct__button\" disabled> Producto añadido </button>' : '<button class=\"iproduct__button\"> Añadir a carrito </button>';\r\n\r\n    individualProduct.innerHTML = `\r\n    <img class=\"iproduct__img\" src=\"${images}\">\r\n    <div class=\"iproduct__info\">\r\n        <h1>${name}</h1>\r\n        <h2>$${price}</h2>\r\n    </div>\r\n    <h4 class=\"iproduct__color\">${color}</h4>\r\n    ${buttonAddCart}\r\n    `;\r\n    \r\n    stockPrint.appendChild(individualProduct);\r\n\r\n    const addCartButton = individualProduct.querySelector(\".iproduct__button\");\r\n\r\n    addCartButton.addEventListener( \"click\", async (e) => {\r\n        e.preventDefault();\r\n\r\n        cart.push({\r\n            ...iproduct,\r\n            count: count,\r\n        });\r\n\r\n        addProductToCart();\r\n        \r\n        if(userLogged){\r\n            await createFirebaseCart(db, userLogged.uid, cart);\r\n        }\r\n\r\n        addCartButton.setAttribute(\"disabled\", true);\r\n        addCartButton.innerText = \"Producto añadido\";\r\n    });\r\n}\r\n\r\nasync function addProductToCart(){\r\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\r\n}\r\n\r\nfunction getMyCart(){\r\n    const myCart = localStorage.getItem(\"cart\");\r\n    return myCart ? JSON.parse(myCart) : [];\r\n}\r\n\r\n\r\nfunction filterBy(){\r\n    const ctSelectedFilter = ctFilter.value;\r\n    const filteredProducts = displayedProducts.filter((product) => product.product_category === ctSelectedFilter);\r\n\r\n    if(filteredProducts.length === 0){\r\n        loadProducts();\r\n    }\r\n\r\n    stockPrint.innerHTML = \"\";\r\n\r\n    filteredProducts.forEach( product => {\r\n        renderProduct(product);\r\n    });\r\n}\r\n\r\nctFilter.addEventListener(\"change\", e => {\r\n    filterBy();\r\n});\r\n\r\nloadProducts();\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if(user){\r\n        /*userLogged = user;\r\n        cart = await getFirebaseCart(db, userLogged.uid);*/\r\n    } else {\r\n        /*cart = getMyCart();*/\r\n    }\r\n    loadProducts();\r\n});\r\n","import { collection, getDocs } from \"firebase/firestore\";\r\n\r\nasync function getProducts(db){\r\n    try{\r\n        const collectionRef = collection(db, \"products\");\r\n        const { docs } = await getDocs(collectionRef);\r\n\r\n        const products = docs.map((doc) => {\r\n            return{\r\n                ...doc.data(),\r\n                id: doc.id,\r\n            };\r\n        });\r\n\r\n        return products;\r\n    } catch(e){\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nexport{\r\n    getProducts,\r\n}","import { getDoc, setDoc, doc } from \"firebase/firestore\";\r\n\r\nasync function createFirebaseCart(db, userId, cart){\r\n    try{\r\n        await setDoc(doc(db, \"cart\", userId), {cart});\r\n    } catch(e){\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nasync function getFirebaseCart(db, userId){\r\n    try{\r\n        const docRef = doc(db, \"cart\", userId);\r\n        const docSnap = await getDoc(docRef);\r\n        const { cart } = docSnap.data();\r\n        return cart;\r\n    } catch(e){\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nexport {\r\n    createFirebaseCart,\r\n    getFirebaseCart,\r\n}"],"names":["$6QD2Y","parcelRequire","$etBjH","$1bbc37726bcabe05$var$stockPrint","document","getElementById","$1bbc37726bcabe05$var$ctFilter","$1bbc37726bcabe05$var$userLogged","$1bbc37726bcabe05$var$displayedProducts","$1bbc37726bcabe05$var$cart","async","$1bbc37726bcabe05$var$loadProducts","stockProducts","db","collectionRef","collection","docs","getDocs","map","doc","data","id","e","console","log","$1a6f789f8dae86ea$export$68a801b7b3c0bfaa","innerHTML","forEach","product","$1bbc37726bcabe05$var$renderProduct","iproduct","individualProduct","createElement","className","setAttribute","images","product_img","product_name","name","product_price","price","product_reference","reference","product_color","color","product_colection","colection","product_category","category","buttonAddCart","some","productCart","appendChild","addCartButton","querySelector","addEventListener","preventDefault","push","count","localStorage","setItem","JSON","stringify","$1bbc37726bcabe05$var$addProductToCart","userId","cart","setDoc","$cce27b57bca555ec$export$c4c0f4d338c4705c","uid","innerText","ctSelectedFilter","value","filteredProducts","filter","length"],"version":3,"file":"store.48afd913.js.map"}